pipeline {
    // Définir l’agent Jenkins sur lequel s'exécute le pipeline
    // agent any

    agent {
        label 'agent-windows'
    }


    environment {
        // Définir des variables d’environnement pour l’image Docker
        DOCKERHUB_USER = "encvr1"
        IMAGE_NAME     = "backend-courrier"
        IMAGE_TAG      = "1.${BUILD_NUMBER}"
    }

    stages {

        stage('Checkout Code') {
            steps {
                // Récupérer le code source depuis le dépôt Git (SCM)
                checkout scm
            }
        }



        stage('Deploy with Docker Compose') {
            steps {
                // Déployer les services avec Docker Compose en mode détaché
                bat "docker-compose down || true"
                bat "docker-compose up -d --build"
            }
        }
    }

    post {
        success {
            // Afficher un message si le pipeline réussit
            echo " Déploiement réussi"
        }
        failure {
            // Afficher un message si le pipeline échoue
            echo " Le pipeline a échoué, vérifie les logs Jenkins."
        }



    }
}
